---
import { storyblokEditable } from '@storyblok/astro';
const { blok, index } = Astro.props;

const tags = blok.technologies?.split(',').map((t: string) => t.trim()) || [];
const isReversed = index % 2 !== 0;

// FORZAMOS MINÃšSCULAS: Para que 'Data', 'data' y 'DATA' sean lo mismo
const category = blok.category?.toLowerCase() || 'software';
---

<div 
  {...storyblokEditable(blok)} 
  class="project-card flex flex-col lg:flex-row bg-[#111827] rounded-xl overflow-hidden shadow-xl border border-gray-800 hover:border-blue-500/30 transition-all duration-300 h-auto lg:h-[320px]"
  data-category={category} 
>
  <p style="background: red; color: white; position: absolute; z-index: 50;">
  VALOR REAL: {blok.category}
</p>
  <div class={`w-full lg:w-[45%] h-64 lg:h-full bg-gray-900 relative group overflow-hidden ${isReversed ? 'lg:order-2' : 'lg:order-1'}`}>
    {
      blok.image?.filename && (
        <img 
          src={blok.image.filename} 
          alt={blok.title} 
          class="w-full h-full object-cover object-center group-hover:scale-105 transition-transform duration-500"
        />
      )
    }
    <div class="absolute inset-0 bg-blue-900/10 group-hover:bg-transparent transition-colors duration-300"></div>
  </div>

  <div class={`w-full lg:w-[55%] p-6 lg:p-8 flex flex-col justify-center ${isReversed ? 'lg:order-1' : 'lg:order-2'}`}>
    
    <div>
        <h3 class="text-xl font-bold text-white mb-2">{blok.title}</h3>
        <p class="text-gray-400 text-sm leading-relaxed line-clamp-3 mb-4">
        {blok.description}
        </p>
    </div>

    <div class="flex flex-wrap gap-2 mb-4">
      {tags.map((tag: string) => (
        <span class="px-2.5 py-0.5 text-xs font-medium text-blue-200 bg-blue-900/30 rounded-full border border-blue-900/50">
          {tag}
        </span>
      ))}
    </div>

    {blok.link?.url && (
      <a href={blok.link.url} target="_blank" class="self-start inline-flex items-center gap-2 text-white hover:text-blue-400 transition-colors text-sm font-semibold">
        <span>Ver Proyecto</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
      </a>
    )}

  </div>

</div>